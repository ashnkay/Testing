<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Visitor Notes - Kayla's Art Gallery</title>
  <style>
    body {
      background-color: #222;
      color: #ddd;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0 0 60px 0; /* space for footer */
    }
    header {
      background: #333;
      padding: 15px;
      text-align: center;
      font-size: 1.5em;
      font-weight: bold;
      color: #f0c;
    }
    main {
      max-width: 600px;
      margin: 20px auto;
      padding: 0 15px;
    }
    textarea {
      width: 100%;
      height: 80px;
      background: #444;
      border: none;
      color: #eee;
      padding: 10px;
      font-size: 1em;
      border-radius: 5px;
      resize: vertical;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      background: #f0c;
      border: none;
      color: #222;
      font-weight: bold;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #d0a;
    }
    ul#notes-list {
      list-style: none;
      padding: 0;
      margin-top: 20px;
    }
    ul#notes-list li {
      background: #333;
      margin-bottom: 12px;
      padding: 12px;
      border-radius: 6px;
      position: relative;
      word-wrap: break-word;
      white-space: pre-wrap;
    }
    ul#notes-list li button.delete-btn {
      position: absolute;
      right: 8px;
      top: 8px;
      background: #900;
      border: none;
      color: #fff;
      border-radius: 3px;
      padding: 2px 8px;
      cursor: pointer;
      font-size: 0.9em;
    }
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 50px;
      gap: 40px;
      z-index: 100;
    }
    footer a {
      color: #f0c;
      font-size: 1.3em;
      text-decoration: none;
      user-select: none;
      transition: color 0.2s ease;
    }
    footer a:hover {
      color: #d09;
    }
    /* Heart decorative button on the right */
    #heart-decor {
      position: fixed;
      top: 15px;
      right: 15px;
      font-size: 2em;
      color: #f0c;
      user-select: none;
      pointer-events: none;
      z-index: 101;
    }
  </style>
</head>
<body>
  <header>Visitor Notes</header>

  <main>
    <textarea id="note-input" placeholder="Write your note here..."></textarea>
    <button id="submit-note">Post Note</button>

    <ul id="notes-list"></ul>
  </main>

  <footer>
    <a href="index.html">Home</a>
    <a href="gallery.html">Gallery</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
  </footer>

  <div id="heart-decor">❤️</div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyB6fXcN5oF0a9dFdqZAfnhPu3Jr24uWoic",
      authDomain: "kaylasartcomments.firebaseapp.com",
      databaseURL: "https://kaylasartcomments-default-rtdb.firebaseio.com",
      projectId: "kaylasartcomments",
      storageBucket: "kaylasartcomments.firebasestorage.app",
      messagingSenderId: "591454461493",
      appId: "1:591454461493:web:4aa69c08127a8988555b7c",
      measurementId: "G-KM52V6M1SE"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Generate or get stored userId
    function getUserId() {
      let id = localStorage.getItem("userId");
      if (!id) {
        id = crypto.randomUUID();
        localStorage.setItem("userId", id);
      }
      return id;
    }
    const userId = getUserId();

    const notesList = document.getElementById('notes-list');
    const noteInput = document.getElementById('note-input');
    const submitBtn = document.getElementById('submit-note');

    // Load notes from Firebase and listen for updates
    function loadNotes() {
      const notesRef = db.ref('visitor-notes');
      notesRef.on('value', snapshot => {
        notesList.innerHTML = '';
        const notes = snapshot.val();
        if (!notes) return;
        Object.entries(notes).forEach(([id, note]) => {
          const li = document.createElement('li');
          li.textContent = note.text;

          // Add delete button if the note belongs to this user
          if (note.userId === userId) {
            const delBtn = document.createElement('button');
            delBtn.textContent = 'Delete';
            delBtn.className = 'delete-btn';
            delBtn.onclick = () => deleteNote(id);
            li.appendChild(delBtn);
          }
          notesList.appendChild(li);
        });
      });
    }

    // Post new note
    function postNote() {
      const text = noteInput.value.trim();
      if (!text) {
        alert('Write something before posting!');
        return;
      }
      const notesRef = db.ref('visitor-notes');
      const newNoteRef = notesRef.push();
      newNoteRef.set({
        text: text,
        userId: userId
      }).then(() => {
        noteInput.value = '';
      }).catch(() => {
        alert('Oops, failed to post your note. Try again.');
      });
    }

    // Delete note by id
    function deleteNote(noteId) {
      if (!confirm('Are you sure you want to delete this note?')) return;
      const noteRef = db.ref('visitor-notes/' + noteId);
      noteRef.remove().catch(() => {
        alert('Failed to delete the note. Try again.');
      });
    }

    submitBtn.addEventListener('click', postNote);

    // Also post on Ctrl+Enter or Cmd+Enter
    noteInput.addEventListener('keydown', e => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        postNote();
      }
    });

    loadNotes();
  </script>
</body>
</html>
